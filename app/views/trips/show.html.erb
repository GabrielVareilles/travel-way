<div class="container">
  <h1>Trip: <%= @trip.name %></h1>
          <%fail%>
  <a name="top"></a>
  <div class="main-content container fluid-container">
    <ul id="timeline" class="timeline">
      <% @sliced_activities.each do |activities_per_group| %>
        <% activities_per_group.each_with_index do |group, index| %>
          <li>
            <a name="section-<%= index+1 %>"></a>
            <div class="timeline-badge">
            </div>
            <div class="timeline-line">
            </div>
                <div class="timeline-panel">
                  <div class="timeline-body">
                    <div class="top-link">
                      <a href="javascript:void(0);" onclick="scrollToAnchor('top')">
                        <span class="glyphicon glyphicon-menu-up"></span>
                      </a>
                    </div>
                    <% city = group.first.place_name %>
                    <h1><%= city %></h1>
                    <h5><%= "Day #{index + 1}" %></h5>
                    <div class="row">
                      <% group.each_with_index do |activity, ind| %>
                        <div class="col-md-4 col-sm-6 service panel">
                          <div class="panel-heading background-with-image-<%= ind + 1 %>">
                            <div class="panel-icon">
                              <span class="glyphicon glyphicon-repeat"></span>
                            </div>
                            <div class="panel-title">
                              <h4><%= activity.name %></h4>
                            </div>
                          </div>
                          <div class="panel-body">
                            <p>Description blablabla blablabla blablabla blablabla blablabla</p>
                          </div>
                        </div>
                      <% end %>
                        <div id="map_<%= city %>" style="width: 100%; height: 300px; border-radius: 6px;"></div>

                          <% content_for :after_js do %>
                            <script>
                              $(function(handler) {
                                var handler = Gmaps.build('Google');
                                handler.buildMap({ internal: { id: 'map_<%= city %>' } }, function() {
                                  markers = handler.addMarkers(<%= raw @hash[city].to_json %>);
                                  handler.bounds.extendWith(markers);
                                  handler.fitMapToBounds();
                                  if (markers.length == 0) {
                                    handler.getMap().setZoom(2);
                                  } else if (markers.length == 1) {
                                    handler.getMap().setZoom(14);
                                  }
                                });
                              });
                            </script>
                          <% end %>
                    </div>
                  </div>
          </li>
        <% end %>
      <% end %>
    </ul>
  </div>
</div>



<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

     <script type="text/javascript">
        $( document ).ready(function() {
          console.log('test');

          var numItems = $('#timeline .timeline-badge').length;
          var gradientColours = "";

          for(var i = 0; i < numItems; i ++){
            if(i > 0) gradientColours += ", ";
            var badgeClass  = "";
            var lineClass  = "";

            // change the gradientColours value as required. Also see badgeClass and lineClass in css/styles.css
            if((i+1) % 4 == 0){
                badgeClass  = "badge-4";
                lineClass  = "line-4";
                gradientColours += "#70c6da";
            }else if((i+1) % 3 == 0){
                badgeClass  = "badge-3";
                lineClass  = "line-3";
                gradientColours += "#6fc6d9";
            }else if((i+1) % 2 == 0){
                badgeClass  = "badge-2";
                lineClass  = "line-2";
                gradientColours += "#56c2b1";
            }else{
                badgeClass  = "badge-1";
                lineClass  = "line-1";
                gradientColours += "#ed78a6";
            }
            if(i < numItems -1){
              ($('#timeline .timeline-line').eq(i)).addClass(lineClass);
            }
            ($('#timeline .timeline-badge').eq(i)).addClass(badgeClass);
          }

          var styleString = "<style>";
          styleString += ".timeline:before{background: -webkit-linear-gradient('+gradientColours+');background: -o-linear-gradient('+gradientColours+'); background: -moz-linear-gradient('+gradientColours+'); background: linear-gradient('+gradientColours+')}";
          styleString += "</style>";

          $('head').append(styleString);


          // Sticky Menu
          var stickyNavTop = $('.header-menu').offset().top + 30;
          var stickyNavTopMobile = $('.mobile-header-menu').offset().top + 10;
          var stickyNav = function(){
          var scrollTop = $(window).scrollTop();

            if(scrollTop > stickyNavTopMobile) {
              $('.mobile-header-menu').addClass('mobile-sticky');
              $('.mobile-header-menu .menu-logo').addClass('show');
            }else{
              $('.mobile-header-menu').removeClass('mobile-sticky');
              $('.mobile-header-menu .menu-logo').removeClass('show');
            }

            if (scrollTop > stickyNavTop) {
                $('.header-menu').addClass('sticky');
                $('.header-menu-content').addClass('header-menu-content-sticky');
                $('.header-menu').removeClass('container');
                $('.header-menu').removeClass('fluid-container');
                $('.header-menu').removeClass('content-area');
                $('.header-menu-content .menu-logo').addClass('show');

            } else {
                $('.header-menu').removeClass('sticky');
                $('.header-menu-content').removeClass('header-menu-content-sticky');
                $('.header-menu').addClass('container');
                $('.header-menu').addClass('fluid-container');
                $('.header-menu').addClass('content-area');
                $('.header-menu-content .menu-logo').removeClass('show');

            }
          };

          stickyNav();

          $(window).scroll(function() {
              stickyNav();
          });

        });

        function scrollToAnchor(aid){
            var aTag = $("a[name='"+ aid +"']");
            $('html,body').animate({scrollTop: aTag.offset().top-80},'slow');
        }
</script>
